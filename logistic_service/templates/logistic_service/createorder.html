{% extends 'logistic_service/base.html' %}
{% load static %}

{%block HeaderBlock%}

{%endblock%}

{% block title %}
    {{title}}
{% endblock %}

{% block MainContent %}
    <div class="container">
        <form method="post">
            {%csrf_token%}
            <div class="error_wrapper">
                {% for error in form.phone_number.errors %}
                    {{ error | escape }}
                {% endfor %}
            </div>
            {{form.phone_number}} <br>

            <div class="error_wrapper">
                {% for error in form.street.errors %}
                    {{ error | escape }}
                {% endfor %}
            </div>

            <div class="error_wrapper">
                {% for error in form.region.errors %}
                    {{ error | escape }}
                {% endfor %}
            </div>
            <div id="idDistrict">
                {{form.region}}
            </div>
            <br>

            <div class="error_wrapper">
                {% for error in form.city.errors %}
                    {{ error | escape }}
                {% endfor %}
            </div>
            <div id="idDistrict">
                {{form.city}}
            </div>
            <br>

            <div class="error_wrapper">
                {% for error in form.district.errors %}
                    {{ error | escape }}
                {% endfor %}
            </div>
            <div id="idDistrict">
                {{form.district}}
            </div>
            <br>

            <div id="idStreet">
                {{form.street}}
            </div>
            <br>

            <div class="error_wrapper">
                {% for error in form.home.errors %}
                    {{ error | escape }}
                {% endfor %}
            </div>
            {{form.home}} <br>

            <div class="error_wrapper">
                {% for error in form.mass.errors %}
                    {{ error | escape }}
                {% endfor %}
            </div>
            {{form.mass}} <br>

            <button class="w-100 btn btn-primary btn-lg" type="submit">Оформить заказ</button>
            <span>{{error}}</span>
        </form>
    </div>
    <script>
        var regions = document.getElementById('id_region');
        var cities = document.getElementById('id_city');
        var districts = document.getElementById('id_district');
        var streets = document.getElementById('id_street');

        regions.addEventListener('change', change_city);
        cities.addEventListener('change', change_districts);
        districts.addEventListener('change', change_streets);

        function change_city() {
            cities.innerHTML = '';
            cities.append(new Option('Выберите город', 'empty'));
            {% for city in cities %}
                if (regions.options[regions.selectedIndex].text == `{{ city.region.name }}`) {
                    cities.append(new Option('{{city.name}}', '{{ city.name }}'));
                }
            {% endfor %}
        }

        function change_districts() {
            districts.innerHTML = '';
            districts.append(new Option('Выберите район', 'empty'));
            {% for district in districts %}
                if (cities.options[cities.selectedIndex].text == `{{ district.city.name }}`) {
                    districts.append(new Option('{{district.name}}', '{{ district.name }}'));
                }
            {% endfor %}
        }



        function change_streets() {
            streets.innerHTML = '';
            streets.append(new Option('Выберите улицу', 'empty'));
            {% for street in streets %}
                if (districts.options[districts.selectedIndex].text == `{{ street.district.name }}`) {
                    streets.append(new Option('{{street.name}}', '{{ street.name }}'));
                }
            {% endfor %}
        }
    </script>
{% endblock %}